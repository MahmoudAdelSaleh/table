<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…ØªØ¬Ø± Ø´Ø§Ù…Ù„</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <style>
    body { font-family: 'Arial'; direction: rtl; background: #f9f9f9; padding: 20px; }
    h2 { color: #333; }
    .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
    input, button, textarea { width: 100%; margin: 10px 0; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    .chat-box { height: 200px; overflow-y: scroll; background: #eee; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
    .product { background: #f0f0f0; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
    img { max-width: 100%; border-radius: 5px; margin-top: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ›ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <div class="product">Ù…Ù†ØªØ¬ 1 - 100 Ø¬Ù†ÙŠÙ‡ <button onclick="startChat('Ù…Ù†ØªØ¬ 1')">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button></div>
    <div class="product">Ù…Ù†ØªØ¬ 2 - 150 Ø¬Ù†ÙŠÙ‡ <button onclick="startChat('Ù…Ù†ØªØ¬ 2')">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button></div>

    <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„</h2>
    <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="register()">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
    <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>

    <h2>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
    <div class="chat-box" id="chatBox"></div>
    <textarea id="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..."></textarea>
    <button onclick="sendMessage()">ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©</button>
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="sendImage()">ğŸ“· Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø©</button>
  </div>

  <script>
    const firebaseConfig = {
     apiKey: "AIzaSyCCEHZIqOdjXbEgvt49TzdeqYTm0cO3jro",
  authDomain: "table-2026.firebaseapp.com",
  projectId: "table-2026",
  storageBucket: "table-2026.firebasestorage.app",
  messagingSenderId: "860273541011",
  appId: "1:860273541011:web:062d547802dd3cddc1b266",
  measurementId: "G-TWKVJFF97J"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    let currentProduct = "";

    function startChat(product) {
      currentProduct = product;
      document.getElementById("message").value = `Ø£Ø±ØºØ¨ ÙÙŠ Ø´Ø±Ø§Ø¡ ${product}`;
    }

    function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const name = document.getElementById("name").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(user => {
          db.collection("users").doc(user.user.uid).set({ name, email });
          alert("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
        })
        .catch(err => alert("âŒ " + err.message));
    }

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"))
        .catch(err => alert("âŒ " + err.message));
    }

    function sendMessage() {
      const msg = document.getElementById("message").value;
      const user = auth.currentUser;
      if (!user) return alert("â— ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
      db.collection("messages").add({
        sender: user.email,
        receiver: "admin",
        product: currentProduct,
        message: msg,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      document.getElementById("message").value = "";
    }

    function sendImage() {
      const file = document.getElementById("imageInput").files[0];
      const user = auth.currentUser;
      if (!user || !file) return alert("â— ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©");

      const storageRef = storage.ref(`images/${user.uid}/${Date.now()}_${file.name}`);
      storageRef.put(file).then(snapshot => {
        snapshot.ref.getDownloadURL().then(url => {
          db.collection("messages").add({
            sender: user.email,
            receiver: "admin",
            imageUrl: url,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©");
        });
      }).catch(err => alert("âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: " + err.message));
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        db.collection("messages")
          .where("sender", "==", user.email)
          .orderBy("timestamp")
          .onSnapshot(snapshot => {
            const chatBox = document.getElementById("chatBox");
            chatBox.innerHTML = "";
            snapshot.forEach(doc => {
              const data = doc.data();
              if (data.message) {
                chatBox.innerHTML += `<div><strong>Ø£Ù†Øª:</strong> ${data.message}</div>`;
              }
              if (data.imageUrl) {
                chatBox.innerHTML += `<div><strong>ğŸ“· ØµÙˆØ±Ø©:</strong><br><img src="${data.imageUrl}" width="150"></div>`;
              }
            });
          });
      }
    });
  </script>
</body>
</html>
